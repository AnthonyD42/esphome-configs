# https://aaronredding.com/esphome-treatlife-smart-dimmer-plug-with-2-sockets-dp12/
substitutions:
  name: treatlife-ds10-dimmer-plug-01
  friendly_name: TreatLife DS10 Dimmer Plug 01
  device_description: "Treatlife DP10 Smart Dimmer Plug with 1 Socket"
  icon: mdi:power-socket-us
  update_interval_wifi: "60s"

esphome:
  name: ${name}
  name_add_mac_suffix: false
  friendly_name: ${friendly_name}
  on_boot:
    priority: 600
    then:
      lambda: |-
        id(Outlet1).remote_values.set_brightness(100);
        // id(Outlet2).remote_values.set_brightness(100);

bk72xx:
  board: cb3s

logger:
  level: DEBUG
  baud_rate: 0

web_server:
  port: 80
  version: 3

captive_portal:

mdns:

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

# Enable over the air update with password
ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "${friendly_name} AP"
    password: !secret ap_password

time:
  - platform: homeassistant
    id: homeassistant_time

button:
  - platform: restart
    name: Restart

text_sensor:
  - platform: version
    name: Version
  - platform: debug
    reset_reason:
      name: Reset Reason
  - platform: libretiny
    version:
      name: LibreTiny Version

uart:
  rx_pin: RX1
  tx_pin: TX1
  baud_rate: 115200

debug:
  update_interval: 30s

# DPIDs processed from schema model: 000004cn7x
tuya:
  time_id: homeassistant_time # This links the Tuya component to the time component

sensor:
  - platform: wifi_signal
    name: Wifi Signal
    update_interval: 60s
  - platform: uptime
    name: Uptime
    unit_of_measurement: minutes
    filters:
      - lambda: return x / 60.0;
    
light:
  - platform: "tuya"
    name: Outlet 1
    id: Outlet1
    dimmer_datapoint: 2
    switch_datapoint: 1
    min_value: 100
    max_value: 1000
#   - platform: "tuya"
#     name: ${device_friendly_name} Outlet 2
#     id: Outlet2
#     dimmer_datapoint: 8
#     switch_datapoint: 7
#     min_value: 100
#     max_value: 1000

select:
  - platform: "tuya"
    id: "dimmer_mode"
    name: Dimming Mode
    enum_datapoint: 4
    options:
      0: LED # Index 0
      1: Incandescent # Index 1
      2: Halogen # Index 2

# You need to adjust it manually: in most cases, use either 9600 or 115200
# W: UPK: Missing mapping for DP 1, BOOL(rw), switch_led_1 (开关1)
# W: UPK: Missing mapping for DP 2, VALUE(rw), bright_value_1 (亮度值)
# W: UPK: Missing mapping for DP 3, VALUE(rw), brightness_min_1 (最小亮度1)
# W: UPK: Missing mapping for DP 4, ENUM(rw), led_type_1 (光源类型1)
# W: UPK: Converter 'base' couldn't process DP 101, RAW(rw), wake_up (wake-up)
# W: UPK: Missing mapping for DP 102, VALUE(rw), count_down (count_down)
# W: UPK: Missing mapping for DP 103, VALUE(rw), bright_value_3 (亮度值（关灯时下发）)
# W: UPK: Missing mapping for DP 104, VALUE(rw), indicator (指示灯控制)
# W: UPK: Converter 'base' couldn't process DP 105, RAW(rw), random_time (离家模式)


# # # The below items are settings imported from LibreTiny
# switch:
#   - platform: tuya
#     switch_datapoint: 1
#     name: (Unconfirmed) Switch Led 1

# number:
#   - platform: tuya
#     number_datapoint: 2
#     name: (Unconfirmed) Bright Value 1
#     min_value: 10
#     max_value: 1000
#     step: 1
#   - platform: tuya
#     number_datapoint: 3
#     name: (Unconfirmed) Brightness Min 1
#     min_value: 10
#     max_value: 1000
#     step: 1
#   - platform: tuya
#     number_datapoint: 102
#     name: (Unconfirmed) Count Down
#     min_value: 0
#     max_value: 1440
#     step: 1
#   - platform: tuya
#     number_datapoint: 103
#     name: (Unconfirmed) Bright Value 3
#     min_value: 10
#     max_value: 1000
#     step: 1
#   - platform: tuya
#     number_datapoint: 104
#     name: (Unconfirmed) Indicator
#     min_value: 0
#     max_value: 2
#     step: 1

# select:
#   - platform: tuya
#     enum_datapoint: 4
#     name: (Unconfirmed) Led Type 1
#     optimistic: true
#     options:
#       0: Led
#       1: Incandescent
#       2: Halogen
